"use strict";(()=>{var e={};e.id=888,e.ids=[888],e.modules={620:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>x,serverHooks:()=>f,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{GET:()=>m,POST:()=>h});var o=r(96559),s=r(48088),a=r(37719),i=r(32190),c=r(31183);let l=e=>{let t=e.match(/[\u3131-\u3163\uac00-\ud7a3]/g),r=t?t.length:0,n=e.replace(/\s/g,"").length;return 0!==n&&r/n>=.6},p=e=>{let t=e.match(/[a-zA-Z]/g)||[],r=e.replace(/\s/g,"").length;return r>0&&t.length/r>=.6},u=async e=>{try{let t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.OPENAI_API_KEY}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'You are a translator. Translate the given Korean text to English naturally and accurately. Translation guidelines: "밈" should be translated as "meme". Only respond with the English translation, no other text.'},{role:"user",content:e}],max_tokens:1e3,temperature:.3})});if(t.ok){let e=await t.json();return e.choices[0]?.message?.content?.trim()||null}}catch(e){console.error("Translation to English failed:",e)}return null},d=async e=>{try{let t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.OPENAI_API_KEY}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'You are a translator. Translate the given English text to Korean naturally and accurately. Translation guidelines: "meme" should be translated as "밈" (not "미미"). Only respond with the Korean translation, no other text.'},{role:"user",content:e}],max_tokens:1e3,temperature:.3})});if(t.ok){let e=await t.json();return e.choices[0]?.message?.content?.trim()||null}}catch(e){console.error("Translation to Korean failed:",e)}return null};async function m(e,{params:t}){try{let{id:e}=await t,r=await c.z.comment.findMany({where:{postId:e,isBlocked:!1},orderBy:{createdAt:"desc"},select:{id:!0,content:!0,nickname:!0,createdAt:!0,updatedAt:!0,author:{select:{username:!0}}}}),n=await Promise.all(r.map(async e=>{let t=null;if(process.env.OPENAI_API_KEY)try{l(e.content)?t=await u(e.content):p(e.content)&&(t=await d(e.content))}catch(t){console.warn("Translation failed for comment:",e.id,t)}return{...e,translatedContent:t}}));return i.NextResponse.json(n)}catch(e){return console.error("댓글 조회 에러:",e),i.NextResponse.json({error:"댓글을 불러오는데 실패했습니다."},{status:500})}}async function h(e,{params:t}){try{let{id:r}=await t,{content:n,nickname:o,password:s}=await e.json();if(!n?.trim())return i.NextResponse.json({error:"댓글 내용을 입력해주세요."},{status:400});if(n.length>1e3)return i.NextResponse.json({error:"댓글은 1000자를 초과할 수 없습니다."},{status:400});if(!s||"string"!=typeof s||s.trim().length<4)return i.NextResponse.json({error:"비밀번호는 4글자 이상 입력해주세요."},{status:400});let a=e.headers.get("x-forwarded-for"),m=a?a.split(",")[0]:e.headers.get("x-real-ip")||"unknown",h=null;try{process.env.OPENAI_API_KEY&&(l(n.trim())?h=await u(n.trim()):p(n.trim())&&(h=await d(n.trim())))}catch(e){console.warn("Translation failed during comment creation:",e)}let x={...await c.z.comment.create({data:{content:n.trim(),postId:r,nickname:o?.trim()||"Anonymous",password:s.trim(),ipAddress:m},select:{id:!0,content:!0,nickname:!0,createdAt:!0,updatedAt:!0}}),translatedContent:h};return i.NextResponse.json(x,{status:201})}catch(e){return console.error("댓글 작성 에러:",e),i.NextResponse.json({error:"댓글 작성에 실패했습니다."},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/posts/[id]/comments/route",pathname:"/api/posts/[id]/comments",filename:"route",bundlePath:"app/api/posts/[id]/comments/route"},resolvedPagePath:"/Users/damanegi/Desktop/dev/KoreanMemes/src/app/api/posts/[id]/comments/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:g,workUnitAsyncStorage:y,serverHooks:f}=x;function w(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:y})}},1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{e.exports=require("node:tty")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16698:e=>{e.exports=require("node:async_hooks")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{e.exports=require("node:child_process")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},51455:e=>{e.exports=require("node:fs/promises")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},76760:e=>{e.exports=require("node:path")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[447,580,275],()=>r(620));module.exports=n})();