"use strict";(()=>{var e={};e.id=855,e.ids=[855],e.modules={1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{e.exports=require("node:tty")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16698:e=>{e.exports=require("node:async_hooks")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{e.exports=require("node:child_process")},33873:e=>{e.exports=require("path")},34579:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>m,serverHooks:()=>w,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{DELETE:()=>l,PUT:()=>c});var o=r(96559),n=r(48088),a=r(37719),i=r(32190),p=r(31183);let u=e=>{let t=e.match(/[a-zA-Z]/g)||[],r=e.replace(/\s/g,"").length;return r>0&&t.length/r>=.6},d=async e=>{try{let t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.OPENAI_API_KEY}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a translator. Translate the given English text to Korean naturally and accurately. Only respond with the Korean translation, no other text."},{role:"user",content:e}],max_tokens:1e3,temperature:.3})});if(t.ok){let e=await t.json();return e.choices[0]?.message?.content?.trim()||null}}catch(e){console.error("Translation failed:",e)}return null};async function c(e,{params:t}){try{let{commentId:r}=await t,{content:s,password:o}=await e.json();if(!s?.trim())return i.NextResponse.json({error:"댓글 내용을 입력해주세요."},{status:400});if(s.length>1e3)return i.NextResponse.json({error:"댓글은 1000자를 초과할 수 없습니다."},{status:400});let n=await p.z.comment.findUnique({where:{id:r}});if(!n)return i.NextResponse.json({error:"댓글을 찾을 수 없습니다."},{status:404});if(!n.password)return i.NextResponse.json({error:"이 댓글은 수정할 수 없습니다. (비밀번호가 설정되지 않음)"},{status:403});if(n.password!==o)return i.NextResponse.json({error:"비밀번호가 일치하지 않습니다."},{status:403});let a=null;try{process.env.OPENAI_API_KEY&&u(s.trim())&&(console.log("English comment detected, translating to Korean..."),a=await d(s.trim()),console.log("Translation result:",a))}catch(e){console.warn("Translation failed during comment update:",e)}let c={...await p.z.comment.update({where:{id:r},data:{content:s.trim(),updatedAt:new Date},select:{id:!0,content:!0,nickname:!0,createdAt:!0,updatedAt:!0}}),translatedContent:a};return i.NextResponse.json(c)}catch(e){return console.error("댓글 수정 에러:",e),i.NextResponse.json({error:"댓글 수정에 실패했습니다."},{status:500})}}async function l(e,{params:t}){try{let{commentId:r}=await t,{password:s}=await e.json(),o=await p.z.comment.findUnique({where:{id:r}});if(!o)return i.NextResponse.json({error:"댓글을 찾을 수 없습니다."},{status:404});if(!o.password)return i.NextResponse.json({error:"이 댓글은 삭제할 수 없습니다. (비밀번호가 설정되지 않음)"},{status:403});if(o.password!==s)return i.NextResponse.json({error:"비밀번호가 일치하지 않습니다."},{status:403});return await p.z.comment.delete({where:{id:r}}),i.NextResponse.json({success:!0,message:"댓글이 삭제되었습니다."})}catch(e){return console.error("댓글 삭제 에러:",e),i.NextResponse.json({error:"댓글 삭제에 실패했습니다."},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/posts/[id]/comments/[commentId]/route",pathname:"/api/posts/[id]/comments/[commentId]",filename:"route",bundlePath:"app/api/posts/[id]/comments/[commentId]/route"},resolvedPagePath:"/Users/damanegi/Desktop/dev/KoreanMemes/src/app/api/posts/[id]/comments/[commentId]/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:w}=m;function g(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},51455:e=>{e.exports=require("node:fs/promises")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},76760:e=>{e.exports=require("node:path")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,275],()=>r(34579));module.exports=s})();