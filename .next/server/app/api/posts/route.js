"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{e.exports=require("node:tty")},9590:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>u,serverHooks:()=>x,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{GET:()=>d,POST:()=>p});var s=t(96559),a=t(48088),n=t(37719),i=t(32190),c=t(38824),l=t(31183);async function p(e){try{console.log("=== POST Environment Variables Debug ==="),console.log("DATABASE_URL exists:",!!process.env.DATABASE_URL),console.log("DATABASE_URL value:",process.env.DATABASE_URL?.substring(0,50)+"..."),console.log("Prisma client status:",typeof l.z);let r=await e.json(),{title:t,koreanTitle:o,content:s,koreanContent:a,category:n,imageUrl:p,additionalImages:d,extractedComments:u,translatedComments:g}=r;if(console.log("=== API POST 디버깅 정보 ==="),console.log("Received body keys:",Object.keys(r)),console.log("Title:",t),console.log("Category:",n),!t||!n)return i.NextResponse.json({error:"Title and category are required"},{status:400});if(!Object.values(c.Category).includes(n))return i.NextResponse.json({error:"Invalid category"},{status:400});let y=await l.z.post.create({data:{title:t,koreanTitle:o||null,content:s||"",koreanContent:a||null,extractedComments:u&&Array.isArray(u)&&u.length>0?JSON.parse(JSON.stringify(u)):void 0,translatedComments:g&&Array.isArray(g)&&g.length>0?JSON.parse(JSON.stringify(g)):void 0,category:n,imageUrl:p||"/image.png",additionalImages:d&&Array.isArray(d)&&d.length>0?JSON.parse(JSON.stringify(d)):void 0,authorId:void 0,likes:0,views:0}});return console.log("New post created:",y.id),i.NextResponse.json({success:!0,post:{id:y.id,title:y.title,category:y.category},message:"Post created successfully"})}catch(e){return console.error("Post creation error:",e),i.NextResponse.json({error:"Failed to create post",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(e){try{try{await l.z.$disconnect(),await l.z.$connect()}catch(e){}let{searchParams:r}=new URL(e.url),t=r.get("category"),o=parseInt(r.get("page")||"1"),s=parseInt(r.get("offset")||"0"),a=parseInt(r.get("limit")||"10"),n=s>0?s:(o-1)*a,p=t&&"ALL"!==t&&Object.values(c.Category).includes(t)?{category:t}:{},[d,u]=await Promise.all([l.z.post.findMany({where:p,orderBy:{createdAt:"desc"},skip:n,take:a,select:{id:!0,title:!0,koreanTitle:!0,content:!0,category:!0,imageUrl:!0,likes:!0,views:!0,createdAt:!0,updatedAt:!0,_count:{select:{comments:{where:{isBlocked:!1}}}}}}),l.z.post.count({where:p})]),g=d.map(e=>({id:e.id,title:e.title,koreanTitle:e.koreanTitle,content:e.content,category:e.category,imageUrl:e.imageUrl,likes:e.likes,views:e.views,commentCount:e._count.comments,createdAt:e.createdAt,updatedAt:e.updatedAt})),y=s>0?Math.floor(s/a)+1:o,x=Math.ceil(u/a);return i.NextResponse.json({posts:g,totalCount:u,currentPage:y,totalPages:x,hasNextPage:y<x,hasPrevPage:y>1,pagination:{currentPage:y,totalPages:x,totalCount:u,hasNext:y<x,hasPrev:y>1}})}catch(e){return console.error("Posts fetch error:",e),console.error("Error stack:",e instanceof Error?e.stack:"No stack trace"),i.NextResponse.json({error:"Failed to fetch posts",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/api/posts/route"},resolvedPagePath:"/Users/damanegi/Desktop/dev/KoreanMemes/src/app/api/posts/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:g,workUnitAsyncStorage:y,serverHooks:x}=u;function m(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:y})}},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16698:e=>{e.exports=require("node:async_hooks")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{e.exports=require("node:child_process")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},51455:e=>{e.exports=require("node:fs/promises")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},76760:e=>{e.exports=require("node:path")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[447,580,275],()=>t(9590));module.exports=o})();