"use strict";exports.id=551,exports.ids=[551],exports.modules={65551:(t,e,l)=>{l.r(e),l.d(e,{default:()=>s});var a=l(60687),r=l(43210);function s({imageFile:t,onTranslationComplete:e,onCancel:l}){let s=(0,r.useRef)(null),[i,n]=(0,r.useState)(null),[h,o]=(0,r.useState)(!1),[d,c]=(0,r.useState)(null),[u,g]=(0,r.useState)([]),[f,x]=(0,r.useState)(!1),[p,m]=(0,r.useState)({x:1,y:1}),[w,b]=(0,r.useState)(null),[y,T]=(0,r.useState)(null),[j,v]=(0,r.useState)(""),S=(0,r.useCallback)(()=>{let t=s.current,e=t?.getContext("2d");t&&e&&i&&(e.clearRect(0,0,t.width,t.height),e.drawImage(i,0,0,t.width,t.height),u.forEach(t=>{if(t.translatedText){let l=t.startX,a=t.startY,r=t.width,s=t.height;if(e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(l,a,r,s),y===t.id?e.strokeStyle="#ff0000":e.strokeStyle="#333333",e.lineWidth=1,e.strokeRect(l,a,r,s),y===t.id){e.strokeStyle="#ff6666",e.lineWidth=2;let t=.1*Math.min(r,s);e.beginPath(),e.moveTo(l+t,a+t),e.lineTo(l+r-t,a+s-t),e.stroke(),e.beginPath(),e.moveTo(l+r-t,a+t),e.lineTo(l+t,a+s-t),e.stroke()}let i=.9*r,n=.9*s,h=t.translatedText.split(" "),o=Math.min(.3*s,40),d=Math.min(.5*s,60),c=8;for(let t=8;t<=d;t+=2){e.font=`bold ${t}px Arial, sans-serif`;let l=[],a="";for(let t of h){let r=a?`${a} ${t}`:t;e.measureText(r).width<=i?a=r:a?(l.push(a),a=t):l.push(t)}a&&l.push(a);let r=1.3*t;if(l.length*r<=n)c=t;else break}o=Math.max(c,8),e.font=`bold ${o}px Arial, sans-serif`,e.fillStyle="white",e.textAlign="center",e.textBaseline="top";let u=[],g="";for(let t of h){let l=g?`${g} ${t}`:t;e.measureText(l).width<=i?g=l:g?(u.push(g),g=t):u.push(t)}g&&u.push(g);let f=1.3*o,x=a+(s-u.length*f)/2;u.forEach((t,a)=>{let s=l+r/2;e.fillText(t,s,x+a*f)})}else t.isTranslating&&(e.fillStyle="rgba(255, 255, 0, 0.3)",e.fillRect(t.startX,t.startY,t.width,t.height),e.strokeStyle="#ffd700",e.lineWidth=2,e.strokeRect(t.startX,t.startY,t.width,t.height),e.fillStyle="white",e.font="bold 16px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("번역 중...",t.startX+t.width/2,t.startY+t.height/2))}),d&&(e.strokeStyle="#ff0000",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(d.startX,d.startY,d.width,d.height),e.setLineDash([])))},[i,u,d,p,y]),X=async()=>{if(!h||!d)return;if(o(!1),20>Math.abs(d.width)||20>Math.abs(d.height))return void c(null);let t={...d,startX:d.width<0?d.startX+d.width:d.startX,startY:d.height<0?d.startY+d.height:d.startY,width:Math.abs(d.width),height:Math.abs(d.height),isTranslating:!0};g(e=>[...e,t]),c(null),await Y(t)},Y=async t=>{try{let e=document.createElement("canvas"),l=e.getContext("2d");if(!l||!i)return;let a=t.startX*p.x,r=t.startY*p.y,s=t.width*p.x,n=t.height*p.y;e.width=s,e.height=n,l.drawImage(i,a,r,s,n,0,0,s,n);let h=await new Promise(t=>{e.toBlob(e=>t(e),"image/png")}),o=new FormData;o.append("image",h,"selection.png"),o.append("ocrOnly","true");let d=await fetch("/api/upload",{method:"POST",body:o}),c=await d.json();c.success&&c.translatedText?g(e=>e.map(e=>e.id===t.id?{...e,translatedText:c.translatedText,isTranslating:!1}:e)):g(e=>e.filter(e=>e.id!==t.id))}catch(e){console.error("Translation error:",e),g(e=>e.filter(e=>e.id!==t.id))}},k=async()=>{if(0===u.length||u.some(t=>t.isTranslating))return null;try{let t=document.createElement("canvas"),e=t.getContext("2d");if(!e||!i)return null;t.width=i.width,t.height=i.height,e.drawImage(i,0,0),u.forEach(t=>{if(t.translatedText){let l=t.startX*p.x,a=t.startY*p.y,r=t.width*p.x,s=t.height*p.y;e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(l,a,r,s),e.strokeStyle="#333333",e.lineWidth=1,e.strokeRect(l,a,r,s);let i=.9*r,n=.9*s,h=t.translatedText.split(" "),o=Math.min(.5*s,60),d=8;for(let t=8;t<=o;t+=2){e.font=`bold ${t}px Arial, sans-serif`;let l=[],a="";for(let t of h){let r=a?`${a} ${t}`:t;e.measureText(r).width<=i?a=r:a?(l.push(a),a=t):l.push(t)}a&&l.push(a);let r=1.3*t;if(l.length*r<=n)d=t;else break}let c=Math.max(d,8);e.font=`bold ${c}px Arial, sans-serif`,e.fillStyle="white",e.textAlign="center",e.textBaseline="top";let u=l+r/2,g=[],f="";for(let t of h){let l=f?`${f} ${t}`:t;e.measureText(l).width<=i?f=l:f?(g.push(f),f=t):g.push(t)}f&&g.push(f);let x=1.3*c,m=g.length*x,w=a+(s-m)/2;g.forEach((t,l)=>{e.fillText(t,u,w+l*x)})}});let l=await new Promise(e=>{t.toBlob(t=>e(t),"image/jpeg",.85)}),a=new FormData;a.append("image",l,"translated.jpg"),a.append("translateImage","false");let r=await fetch("/api/upload",{method:"POST",body:a}),s=await r.json();if(s.success)return s.imageUrl;return null}catch(t){return console.error("Generate translated image error:",t),null}},M=async()=>{if(0!==u.length&&!u.some(t=>t.isTranslating)){x(!0);try{let t=await k();t&&(v(t),e(t))}catch(t){console.error("Complete error:",t)}finally{x(!1)}}};return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"이미지 번역 편집기"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsx)("p",{children:"마우스로 드래그하여 번역할 텍스트 영역을 선택하세요"}),(0,a.jsxs)("p",{className:"text-xs",children:["\uD83D\uDCA1 ",(0,a.jsx)("strong",{children:"팁:"})," 선택된 영역을 ",(0,a.jsx)("span",{className:"text-red-600",children:"클릭"}),"하거나 ",(0,a.jsx)("span",{className:"text-red-600",children:"우클릭"}),"하면 개별 삭제됩니다"]})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)("canvas",{ref:s,onMouseDown:t=>{if(!i)return;let e=s.current;if(!e)return;let l=e.getBoundingClientRect(),a=t.clientX-l.left,r=t.clientY-l.top;for(let t=u.length-1;t>=0;t--){let e=u[t];if(a>=e.startX&&a<=e.startX+e.width&&r>=e.startY&&r<=e.startY+e.height)return void g(t=>t.filter(t=>t.id!==e.id))}o(!0),b({x:a,y:r}),c({id:`selection-${Date.now()}`,startX:a,startY:r,width:0,height:0,isTranslating:!1,translatedText:""})},onMouseMove:t=>{let e=s.current;if(!e)return;let l=e.getBoundingClientRect(),a=t.clientX-l.left,r=t.clientY-l.top,n=null;for(let t=u.length-1;t>=0;t--){let e=u[t];if(a>=e.startX&&a<=e.startX+e.width&&r>=e.startY&&r<=e.startY+e.height){n=e.id;break}}if(T(n),h&&w&&i){let t=a-w.x,e=r-w.y;c(l=>l?{...l,width:Math.abs(t),height:Math.abs(e),startX:t<0?a:w.x,startY:e<0?r:w.y}:null),S()}},onMouseUp:X,onContextMenu:t=>{if(t.preventDefault(),!i)return;let e=s.current;if(!e)return;let l=e.getBoundingClientRect(),a=t.clientX-l.left,r=t.clientY-l.top;for(let t=u.length-1;t>=0;t--){let e=u[t];if(a>=e.startX&&a<=e.startX+e.width&&r>=e.startY&&r<=e.startY+e.height)return void g(t=>t.filter(t=>t.id!==e.id))}},className:"cursor-crosshair block w-full border border-gray-300 rounded-lg"})})}),(0,a.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,a.jsx)("button",{onClick:()=>{g([]),c(null)},disabled:0===u.length,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"선택 초기화"}),(0,a.jsx)("button",{onClick:M,disabled:0===u.length||f,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:f?"처리 중...":"번역 완료"}),(0,a.jsx)("button",{onClick:l,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"취소"})]}),u.length>0&&(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["선택된 영역: ",u.length,"개",u.filter(t=>t.translatedText).length>0&&` (번역 완료: ${u.filter(t=>t.translatedText).length}개)`]})]})})})})}}};