module.exports = {

"[project]/.next-internal/server/app/api/upload/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[project]/src/app/api/upload/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/cloudinary/cloudinary.js [app-route] (ecmascript)");
;
;
// Cloudinary 설정
__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].config({
    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
    api_key: process.env.CLOUDINARY_API_KEY,
    api_secret: process.env.CLOUDINARY_API_SECRET
});
async function POST(request) {
    try {
        console.log('Environment check:', {
            cloud_name: process.env.CLOUDINARY_CLOUD_NAME ? 'Set' : 'Missing',
            api_key: process.env.CLOUDINARY_API_KEY ? 'Set' : 'Missing',
            api_secret: process.env.CLOUDINARY_API_SECRET ? 'Set' : 'Missing',
            openai_key: process.env.OPENAI_API_KEY ? 'Set' : 'Missing'
        });
        const formData = await request.formData();
        const file = formData.get('image');
        const translateImage = formData.get('translateImage') !== 'false';
        const ocrOnly = formData.get('ocrOnly') === 'true' // OCR 전용 모드
        ;
        if (!file) {
            console.error('No file provided');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'No file provided'
            });
        }
        console.log('File info:', {
            name: file.name,
            size: file.size,
            type: file.type,
            translateImage,
            ocrOnly
        });
        const arrayBuffer = await file.arrayBuffer();
        const buffer = Buffer.from(arrayBuffer);
        // OCR 전용 모드: 번역된 텍스트만 반환
        if (ocrOnly) {
            console.log('OCR only mode - extracting and translating text');
            try {
                // OCR만 수행하고 번역된 텍스트 반환
                const translatedText = await extractAndTranslateText(buffer);
                if (!translatedText) {
                    console.log('No Korean text found in selection');
                    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                        success: false,
                        error: 'No Korean text found in the selected area'
                    });
                }
                console.log('OCR translation completed:', translatedText);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    success: true,
                    translatedText
                });
            } catch (error) {
                console.error('OCR translation error:', error);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    success: false,
                    error: 'Failed to extract or translate text'
                });
            }
        }
        // 기존 이미지 업로드 로직
        let processedBuffer = buffer;
        if (translateImage) {
            console.log('Starting image translation...');
            try {
                const { translateImageText } = await __turbopack_context__.r("[project]/src/lib/imageTranslator.ts [app-route] (ecmascript, async loader)")(__turbopack_context__.i);
                processedBuffer = await translateImageText(buffer);
                console.log('Image translation completed');
            } catch (error) {
                console.error('Image translation failed:', error);
                console.log('Proceeding with original image due to translation failure');
                processedBuffer = buffer;
            }
        }
        console.log('Starting Cloudinary upload...');
        const uploadResult = await new Promise((resolve, reject)=>{
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].uploader.upload_stream({
                resource_type: "image",
                folder: "korean-memes",
                quality: "auto",
                fetch_format: "auto"
            }, (error, result)=>{
                if (error) {
                    console.error('Cloudinary upload error:', error);
                    reject(error);
                } else if (result) {
                    console.log('Cloudinary upload success:', result.public_id);
                    resolve({
                        secure_url: result.secure_url,
                        public_id: result.public_id
                    });
                } else {
                    reject(new Error('Upload failed - no result'));
                }
            }).end(processedBuffer);
        });
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            imageUrl: uploadResult.secure_url,
            publicId: uploadResult.public_id
        });
    } catch (error) {
        console.error('Upload API error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: error instanceof Error ? error.message : 'Upload failed'
        });
    }
}
// OCR 및 번역 전용 함수 - OpenAI Vision API 사용
async function extractAndTranslateText(imageBuffer) {
    try {
        const OpenAI = (await __turbopack_context__.r("[project]/node_modules/openai/index.mjs [app-route] (ecmascript, async loader)")(__turbopack_context__.i)).default;
        const openai = new OpenAI({
            apiKey: process.env.OPENAI_API_KEY
        });
        // 이미지를 base64로 변환
        const base64Image = imageBuffer.toString('base64');
        const mimeType = 'image/png' // 기본값으로 PNG 사용
        ;
        console.log('Using OpenAI Vision API for OCR and translation...');
        // OpenAI Vision API로 한 번에 OCR + 번역 수행
        const response = await openai.chat.completions.create({
            model: "gpt-4o-mini",
            messages: [
                {
                    role: "system",
                    content: `You are an expert at reading Korean text from images and translating it to English. 

TASK:
1. Extract any Korean text you see in the image
2. If Korean text is found, translate it to English following these guidelines:
   - Stay close to the literal meaning
   - Preserve casual, humorous, or sarcastic tone
   - Keep translations concise and punchy
   - Use natural English expressions
   - Maintain the original sentence structure when possible

RESPONSE FORMAT:
- If Korean text is found: return ONLY the English translation
- If no Korean text is found: return "NO_KOREAN_TEXT"

EXAMPLES:
Korean: "야, 니는 옷이다 어디 갔나?" → "Hey, where'd your clothes go?"
Korean: "눈 개높음" → "Standards way too high"
Korean: "저 다음 주 전역이라 다 나눠줬습니다" → "Getting discharged next week so I gave them all away"`
                },
                {
                    role: "user",
                    content: [
                        {
                            type: "text",
                            text: "Please extract and translate any Korean text you see in this image:"
                        },
                        {
                            type: "image_url",
                            image_url: {
                                url: `data:${mimeType};base64,${base64Image}`,
                                detail: "high"
                            }
                        }
                    ]
                }
            ],
            max_tokens: 200,
            temperature: 0.3
        });
        const result = response.choices[0]?.message?.content?.trim();
        console.log('Vision API result:', result);
        if (!result || result === "NO_KOREAN_TEXT") {
            console.log('No Korean text detected by Vision API');
            return null;
        }
        return result;
    } catch (error) {
        console.error('Vision API error:', error);
        return null;
    }
}
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__acd77bba._.js.map