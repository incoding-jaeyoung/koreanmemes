(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[615],{4853:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(5155),l=s(2115),r=s(5695),n=s(1154),i=s(7550),o=s(2657),c=s(3500),d=s(4869),m=s(7213),x=s(4229),u=s(6874),h=s.n(u),g=s(1436),p=s(9502),b=s(9569);function f(){var e;let t=(0,r.useParams)(),s=(0,r.useRouter)(),[u,f]=(0,l.useState)(!0),[y,j]=(0,l.useState)(""),[N,v]=(0,l.useState)(""),[w,T]=(0,l.useState)(""),[C,E]=(0,l.useState)(""),[S,O]=(0,l.useState)("HUMOR"),[K,k]=(0,l.useState)(""),[A,P]=(0,l.useState)([]),[U,I]=(0,l.useState)(!1),[D,M]=(0,l.useState)(!1),[R,F]=(0,l.useState)(!1),[L,_]=(0,l.useState)(!1),[H,J]=(0,l.useState)(!1),[z,$]=(0,l.useState)([""]),[Y,q]=(0,l.useState)([""]),[B,G]=(0,l.useState)([]),W=null==t?void 0:t.id,Q=[{value:"HUMOR",label:"K-Humor \uD83D\uDE02",description:"Korean humor, memes, funny content"},{value:"CULTURE",label:"K-Culture \uD83C\uDFEE",description:"Korean culture, traditions, customs"},{value:"DRAMA",label:"K-Drama \uD83D\uDCFA",description:"K-Drama, entertainment, celebrities"},{value:"LIFESTYLE",label:"K-Lifestyle \uD83C\uDF38",description:"Korean daily life, lifestyle"},{value:"TECH",label:"K-Tech \uD83D\uDCBB",description:"Korean IT, startups, technology"},{value:"GENERAL",label:"General \uD83D\uDCAC",description:"Other Korean-related topics"}];(0,l.useEffect)(()=>{W&&(async()=>{try{f(!0);let e=await fetch("/api/posts/".concat(W));if(!e.ok)throw Error("Failed to fetch post");let t=(await e.json()).post;j(t.title||""),v(t.koreanTitle||""),T(t.content||""),E(t.koreanContent||""),O(t.category||"HUMOR"),k(t.imageUrl||"");let s=t.extractedComments||[],a=t.translatedComments||[];$(s.length>0?s:[""]),q(a.length>0?a:[""]);let l=t.additionalImages||[];if(l.length>0){let e=t.imageUrl?[t.imageUrl,...l]:l;P(e),I(!0)}else t.imageUrl&&I(!1)}catch(e){console.error("Error fetching post:",e),alert("게시글을 불러오는데 실패했습니다."),s.push("/")}finally{f(!1)}})()},[W,s]),(0,l.useEffect)(()=>{let e=setTimeout(async()=>{if(!N.trim())return void j("");if(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(N)){_(!0);try{let e=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:N})}),t=await e.json();t.success&&t.translatedText&&j(t.translatedText)}catch(e){console.error("Title translation error:",e)}finally{_(!1)}}},1e3);return()=>clearTimeout(e)},[N]),(0,l.useEffect)(()=>{let e=setTimeout(async()=>{if(!C.trim())return void T("");if(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(C)){J(!0);try{let e=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:C})}),t=await e.json();t.success&&t.translatedText&&T(t.translatedText)}catch(e){console.error("Content translation error:",e)}finally{J(!1)}}},1e3);return()=>clearTimeout(e)},[C]);let V=async(e,t)=>{if(!e.trim()){let e=[...Y];e[t]="",q(e);return}if(!/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(e)||B[t])return;let s=[...B];s[t]=!0,G(s);try{let s=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})}),a=await s.json();if(a.success&&a.translatedText){let e=[...Y];e[t]=a.translatedText,q(e)}}catch(e){console.error("Comment translation error:",e)}finally{let e=[...B];e[t]=!1,G(e)}},X=(e,t)=>{let s=[...z];s[e]=t,$(s),setTimeout(()=>{V(t,e)},1e3)},Z=()=>{$([...z,""]),q([...Y,""])},ee=e=>{let t=z.filter((t,s)=>s!==e),s=Y.filter((t,s)=>s!==e);$(0===t.length?[""]:t),q(0===s.length?[""]:s)},et=async e=>{let t=el(e);if(t.length>0){$(t),q(Array(t.length).fill(""));let e=t.map(async(e,t)=>{if(!e.trim()||!/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(e))return"";try{let t=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})}),s=await t.json();return s.success&&s.translatedText?s.translatedText:""}catch(e){return console.error("Comment ".concat(t+1," translation error:"),e),""}});q(await Promise.all(e))}},es=z.filter(e=>e.trim().length>0),ea=Y.filter((e,t)=>{var s;return(null==(s=z[t])?void 0:s.trim().length)>0&&e.trim().length>0}),el=e=>{let t=e.split("\n").map(e=>e.trim()).filter(e=>e),s=[];console.log("=== 댓글 파싱 시작 ==="),console.log("총 라인 수:",t.length),console.log("처음 5줄:",t.slice(0,5));for(let e=0;e<t.length;e++){let a=t[e];if(console.log("[".concat(e,"] 분석 중:"),a.substring(0,50)),a.includes("베스트")&&a.includes("	")){let l=a.split("	");if(l.length>1){let e=l[l.length-1].replace(/\[\d+\]/g,"").trim();if(e&&e.length>5&&!/^\d+\s*\d*$/.test(e)){console.log("베스트 댓글 발견 (현재 줄):",e),s.push(e);continue}}if(e+1<t.length){let a=t[e+1].replace(/\[\d+\]/g,"").trim();if(a&&a.length>5&&!a.includes("추천")&&!a.includes("반대")&&!/^\d+\s*\d*$/.test(a)){console.log("베스트 댓글 발견 (다음 줄):",a),s.push(a),e++;continue}}}if(a.includes("	")){let l=a.split("	");if(l.length>=2){let a=l[l.length-1].trim();if(a&&a.length>5&&!a.includes("추천")&&!a.includes("반대")&&!a.includes("이동")&&!a.includes("답글")&&!/^\d+\s*\d*$/.test(a)){console.log("일반 댓글 발견 (현재 줄):",a),s.push(a);continue}if(e+1<t.length){let a=t[e+1].trim();if(a&&a.length>5&&!a.includes("추천")&&!a.includes("반대")&&!a.includes("이동")&&!a.includes("답글")&&!/^\d+\s*\d*$/.test(a)){console.log("일반 댓글 발견 (다음 줄):",a),s.push(a),e++;continue}}}}/[ㄱ-ㅎㅏ-ㅣ가-힣]/.test(a)&&/[ㅋㅎㅠㅜㄷ;;!?]/.test(a)&&!a.includes("로그인")&&!a.includes("회원가입")&&!a.includes("메뉴")&&!a.includes("검색")&&!a.includes("추천")&&!a.includes("반대")&&a.length>=5&&a.length<=200&&(console.log("직접 댓글 패턴 발견:",a),s.push(a))}console.log("=== 파싱 결과 ==="),console.log("추출된 댓글 수:",s.length),console.log("댓글 목록:",s);let a=[...new Set(s)].slice(0,10);return console.log("최종 댓글 수:",a.length),a},er=(0,l.useCallback)(e=>{P(e)},[]),en=async e=>{e.preventDefault(),F(!0);try{let e=U?A.length>0?A[0]:"":K,t=U?A.slice(1):[],a=await fetch("/api/posts/".concat(W),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:y,koreanTitle:N,content:w,koreanContent:C,category:S,imageUrl:e,additionalImages:t,extractedComments:es.length>0?es:null,translatedComments:ea.length>0?ea:null})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to update post")}let l=await a.json();console.log("Post updated successfully:",l),s.push("/post/".concat(W))}catch(e){console.error("Post update error:",e),alert("게시글 수정에 실패했습니다: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}finally{F(!1)}};return u?(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"flex justify-center items-center py-12",children:[(0,a.jsx)(n.A,{className:"h-8 w-8 animate-spin text-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading post..."})]})}):(0,a.jsx)(b.O,{children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(h(),{href:"/post/".concat(W),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[(0,a.jsx)(i.A,{className:"h-5 w-5"}),"Back to Post"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Post"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Update your Korean culture content"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("button",{type:"button",onClick:()=>M(!D),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),D?"Edit":"Preview"]})})]}),D?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium",children:null==(e=Q.find(e=>e.value===S))?void 0:e.label})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:y||"Your English Title"}),N&&(0,a.jsxs)("p",{className:"text-gray-600 italic mb-6",children:["Original: ",N]}),K&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("img",{src:K,alt:"Featured",className:"w-full max-w-2xl mx-auto rounded-lg"})}),(0,a.jsxs)("div",{className:"prose max-w-none",children:[(0,a.jsx)("div",{className:"whitespace-pre-wrap text-gray-800 leading-relaxed",children:w||"Your English content will appear here..."}),C&&(0,a.jsxs)("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Korean Original"}),(0,a.jsx)("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed",children:C})]})]})]})}):(0,a.jsxs)("form",{onSubmit:en,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Category"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Q.map(e=>(0,a.jsxs)("label",{className:"relative",children:[(0,a.jsx)("input",{type:"radio",name:"category",value:e.value,checked:S===e.value,onChange:e=>O(e.target.value),className:"sr-only"}),(0,a.jsxs)("div",{className:"p-4 rounded-lg border-2 cursor-pointer transition-all ".concat(S===e.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.label}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:e.description})]})]},e.value))})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(c.A,{className:"h-4 w-4"}),"Korean Original Title"]}),(0,a.jsx)("input",{type:"text",value:N,onChange:e=>v(e.target.value),placeholder:"e.g., Korean Workplace Culture: The Mysterious World of 'Nunchi'",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(d.A,{className:"h-4 w-4"}),"English Title",L&&(0,a.jsxs)("span",{className:"text-xs text-blue-600 flex items-center gap-1",children:[(0,a.jsx)(n.A,{className:"h-3 w-3 animate-spin"}),"Translating..."]})]}),(0,a.jsx)("input",{type:"text",value:y,onChange:e=>j(e.target.value),placeholder:"e.g., Korean Office Culture: The Mystery of 'Nunchi' Explained",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"English title will be automatically translated when you type Korean title"})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),"Featured Images (Optional)"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Mode:"}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"imageMode",checked:!U,onChange:()=>I(!1),className:"text-blue-600"}),(0,a.jsx)("span",{className:"text-sm",children:"Single"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"imageMode",checked:U,onChange:()=>I(!0),className:"text-blue-600"}),(0,a.jsx)("span",{className:"text-sm",children:"Multiple"})]})]})]}),U?(0,a.jsx)(p.l,{onImagesChange:er,currentImages:A,maxImages:5}):(0,a.jsx)(g.B,{onImageUploaded:e=>{k(e)},currentImage:K,onRemoveImage:()=>{k("")}})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(c.A,{className:"h-4 w-4"}),"Korean Original Content (Optional)"]}),(0,a.jsx)("textarea",{value:C,onChange:e=>E(e.target.value),placeholder:"Enter original content about Korean culture or humor...",rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(d.A,{className:"h-4 w-4"}),"English Translation Content (Optional)",H&&(0,a.jsxs)("span",{className:"text-xs text-blue-600 flex items-center gap-1",children:[(0,a.jsx)(n.A,{className:"h-3 w-3 animate-spin"}),"Translating..."]})]}),(0,a.jsx)("textarea",{value:w,onChange:e=>T(e.target.value),placeholder:"Translate and explain Korean culture or humor in English...",rows:10,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"English content will be automatically translated when you type Korean content"})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(d.A,{className:"h-4 w-4"}),"Korean Community Comments (Optional)"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-4",children:"Add best comments from Korean community sites manually"}),(0,a.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCA1 Quick Input: Paste copied comment text"}),(0,a.jsx)("textarea",{placeholder:"Paste comment text copied from Korean community sites here...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm",onPaste:e=>{e.preventDefault(),et(e.clipboardData.getData("text"))}}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Only comment content will be automatically extracted when pasted"})]})]}),z.map((e,t)=>(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-xs text-gray-600 mb-1 block",children:["Korean Original",B[t]&&(0,a.jsxs)("span",{className:"ml-2 text-blue-600 flex items-center gap-1 inline-flex",children:[(0,a.jsx)(n.A,{className:"h-3 w-3 animate-spin"}),"Translating..."]})]}),(0,a.jsx)("textarea",{value:e,onChange:e=>X(t,e.target.value),placeholder:"Enter comment ".concat(t+1,"..."),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),Y[t]&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-600 mb-1 block",children:"English Translation"}),(0,a.jsx)("div",{className:"w-full px-3 py-2 bg-blue-50 border border-blue-200 rounded-lg text-sm text-gray-700",children:Y[t]})]})]})}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[t===z.length-1&&(0,a.jsx)("button",{type:"button",onClick:Z,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"+"}),z.length>1&&(0,a.jsx)("button",{type:"button",onClick:()=>ee(t),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors",children:"\xd7"})]})]})},t)),es.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Preview (",es.length," comments)"]}),(0,a.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:es.map((e,t)=>(0,a.jsx)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:"Korean:"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed",children:e})]}),ea[t]&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-green-600 font-medium",children:"English:"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed",children:ea[t]})]})]})},t))}),(0,a.jsx)("p",{className:"text-xs text-green-600 mt-2",children:"✓ These comments will be displayed at the bottom of your post in both languages"})]})]})}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(h(),{href:"/post/".concat(W),className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:R||!y.trim()||!N.trim(),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:R?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.A,{className:"h-4 w-4 animate-spin"}),"Updating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.A,{className:"h-4 w-4"}),"Update Post"]})})]})]})]})})}},6696:(e,t,s)=>{Promise.resolve().then(s.bind(s,4853))}},e=>{var t=t=>e(e.s=t);e.O(0,[95,924,441,684,358],()=>t(6696)),_N_E=e.O()}]);