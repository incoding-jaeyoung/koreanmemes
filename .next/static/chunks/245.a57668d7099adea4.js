"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[245],{6245:(t,e,l)=>{l.r(e),l.d(e,{default:()=>s});var a=l(5155),r=l(2115);function s(t){let{imageFile:e,onTranslationComplete:l,onCancel:s}=t,i=(0,r.useRef)(null),[n,o]=(0,r.useState)(null),[h,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null),[g,f]=(0,r.useState)([]),[x,p]=(0,r.useState)(!1),[m,w]=(0,r.useState)({x:1,y:1}),[y,b]=(0,r.useState)(null),[T,j]=(0,r.useState)(null),[k,v]=(0,r.useState)("");(0,r.useEffect)(()=>{if(!e)return;let t=new Image;t.onload=()=>{o(t);let e=i.current;if(e){let l=e.parentElement;if(l){let a=l.clientWidth,r=a/(t.width/t.height);e.width=a,e.height=r,e.style.width="".concat(a,"px"),e.style.height="".concat(r,"px"),w({x:t.width/a,y:t.height/r});let s=e.getContext("2d");s&&s.drawImage(t,0,0,a,r)}}};let l=URL.createObjectURL(e);return t.src=l,()=>URL.revokeObjectURL(l)},[e]);let S=(0,r.useCallback)(()=>{let t=i.current,e=null==t?void 0:t.getContext("2d");t&&e&&n&&(e.clearRect(0,0,t.width,t.height),e.drawImage(n,0,0,t.width,t.height),g.forEach(t=>{if(t.translatedText){let l=t.startX,a=t.startY,r=t.width,s=t.height;if(e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(l,a,r,s),T===t.id?e.strokeStyle="#ff0000":e.strokeStyle="#333333",e.lineWidth=1,e.strokeRect(l,a,r,s),T===t.id){e.strokeStyle="#ff6666",e.lineWidth=2;let t=.1*Math.min(r,s);e.beginPath(),e.moveTo(l+t,a+t),e.lineTo(l+r-t,a+s-t),e.stroke(),e.beginPath(),e.moveTo(l+r-t,a+t),e.lineTo(l+t,a+s-t),e.stroke()}let i=.9*r,n=.9*s,o=t.translatedText.split(" "),h=Math.min(.3*s,40),d=Math.min(.5*s,60),c=8;for(let t=8;t<=d;t+=2){e.font="bold ".concat(t,"px Arial, sans-serif");let l=[],a="";for(let t of o){let r=a?"".concat(a," ").concat(t):t;e.measureText(r).width<=i?a=r:a?(l.push(a),a=t):l.push(t)}a&&l.push(a);let r=1.3*t;if(l.length*r<=n)c=t;else break}h=Math.max(c,8),e.font="bold ".concat(h,"px Arial, sans-serif"),e.fillStyle="white",e.textAlign="center",e.textBaseline="top";let u=[],g="";for(let t of o){let l=g?"".concat(g," ").concat(t):t;e.measureText(l).width<=i?g=l:g?(u.push(g),g=t):u.push(t)}g&&u.push(g);let f=1.3*h,x=a+(s-u.length*f)/2;u.forEach((t,a)=>{let s=l+r/2;e.fillText(t,s,x+a*f)})}else t.isTranslating&&(e.fillStyle="rgba(255, 255, 0, 0.3)",e.fillRect(t.startX,t.startY,t.width,t.height),e.strokeStyle="#ffd700",e.lineWidth=2,e.strokeRect(t.startX,t.startY,t.width,t.height),e.fillStyle="white",e.font="bold 16px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("번역 중...",t.startX+t.width/2,t.startY+t.height/2))}),c&&(e.strokeStyle="#ff0000",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(c.startX,c.startY,c.width,c.height),e.setLineDash([])))},[n,g,c,m,T]);(0,r.useEffect)(()=>{S()},[S]);let X=async()=>{if(!h||!c)return;if(d(!1),20>Math.abs(c.width)||20>Math.abs(c.height))return void u(null);let t={...c,startX:c.width<0?c.startX+c.width:c.startX,startY:c.height<0?c.startY+c.height:c.startY,width:Math.abs(c.width),height:Math.abs(c.height),isTranslating:!0};f(e=>[...e,t]),u(null),await Y(t)},Y=async t=>{try{let e=document.createElement("canvas"),l=e.getContext("2d");if(!l||!n)return;let a=t.startX*m.x,r=t.startY*m.y,s=t.width*m.x,i=t.height*m.y;e.width=s,e.height=i,l.drawImage(n,a,r,s,i,0,0,s,i);let o=await new Promise(t=>{e.toBlob(e=>t(e),"image/png")}),h=new FormData;h.append("image",o,"selection.png"),h.append("ocrOnly","true");let d=await fetch("/api/upload",{method:"POST",body:h}),c=await d.json();c.success&&c.translatedText?f(e=>e.map(e=>e.id===t.id?{...e,translatedText:c.translatedText,isTranslating:!1}:e)):f(e=>e.filter(e=>e.id!==t.id))}catch(e){console.error("Translation error:",e),f(e=>e.filter(e=>e.id!==t.id))}};(0,r.useEffect)(()=>{(async()=>{if(0!==g.filter(t=>t.translatedText&&!t.isTranslating).length&&!g.some(t=>t.isTranslating))try{let t=await N();t&&t!==k&&(v(t),l(t))}catch(t){console.error("Auto translation generation error:",t)}})()},[g,l,k]);let N=async()=>{if(0===g.length||g.some(t=>t.isTranslating))return null;try{let t=document.createElement("canvas"),e=t.getContext("2d");if(!e||!n)return null;t.width=n.width,t.height=n.height,e.drawImage(n,0,0),g.forEach(t=>{if(t.translatedText){let l=t.startX*m.x,a=t.startY*m.y,r=t.width*m.x,s=t.height*m.y;e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(l,a,r,s),e.strokeStyle="#333333",e.lineWidth=1,e.strokeRect(l,a,r,s);let i=.9*r,n=.9*s,o=t.translatedText.split(" "),h=Math.min(.5*s,60),d=8;for(let t=8;t<=h;t+=2){e.font="bold ".concat(t,"px Arial, sans-serif");let l=[],a="";for(let t of o){let r=a?"".concat(a," ").concat(t):t;e.measureText(r).width<=i?a=r:a?(l.push(a),a=t):l.push(t)}a&&l.push(a);let r=1.3*t;if(l.length*r<=n)d=t;else break}let c=Math.max(d,8);e.font="bold ".concat(c,"px Arial, sans-serif"),e.fillStyle="white",e.textAlign="center",e.textBaseline="top";let u=l+r/2,g=[],f="";for(let t of o){let l=f?"".concat(f," ").concat(t):t;e.measureText(l).width<=i?f=l:f?(g.push(f),f=t):g.push(t)}f&&g.push(f);let x=1.3*c,p=g.length*x,w=a+(s-p)/2;g.forEach((t,l)=>{e.fillText(t,u,w+l*x)})}});let l=await new Promise(e=>{t.toBlob(t=>e(t),"image/jpeg",.85)}),a=new FormData;a.append("image",l,"translated.jpg"),a.append("translateImage","false");let r=await fetch("/api/upload",{method:"POST",body:a}),s=await r.json();if(s.success)return s.imageUrl;return null}catch(t){return console.error("Generate translated image error:",t),null}},M=async()=>{if(0!==g.length&&!g.some(t=>t.isTranslating)){p(!0);try{let t=await N();t&&(v(t),l(t))}catch(t){console.error("Complete error:",t)}finally{p(!1)}}};return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"이미지 번역 편집기"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsx)("p",{children:"마우스로 드래그하여 번역할 텍스트 영역을 선택하세요"}),(0,a.jsxs)("p",{className:"text-xs",children:["\uD83D\uDCA1 ",(0,a.jsx)("strong",{children:"팁:"})," 선택된 영역을 ",(0,a.jsx)("span",{className:"text-red-600",children:"클릭"}),"하거나 ",(0,a.jsx)("span",{className:"text-red-600",children:"우클릭"}),"하면 개별 삭제됩니다"]})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)("canvas",{ref:i,onMouseDown:t=>{if(!n)return;let e=i.current;if(!e)return;let l=e.getBoundingClientRect(),a=t.clientX-l.left,r=t.clientY-l.top;for(let t=g.length-1;t>=0;t--){let e=g[t];if(a>=e.startX&&a<=e.startX+e.width&&r>=e.startY&&r<=e.startY+e.height)return void f(t=>t.filter(t=>t.id!==e.id))}d(!0),b({x:a,y:r}),u({id:"selection-".concat(Date.now()),startX:a,startY:r,width:0,height:0,isTranslating:!1,translatedText:""})},onMouseMove:t=>{let e=i.current;if(!e)return;let l=e.getBoundingClientRect(),a=t.clientX-l.left,r=t.clientY-l.top,s=null;for(let t=g.length-1;t>=0;t--){let e=g[t];if(a>=e.startX&&a<=e.startX+e.width&&r>=e.startY&&r<=e.startY+e.height){s=e.id;break}}if(j(s),h&&y&&n){let t=a-y.x,e=r-y.y;u(l=>l?{...l,width:Math.abs(t),height:Math.abs(e),startX:t<0?a:y.x,startY:e<0?r:y.y}:null),S()}},onMouseUp:X,onContextMenu:t=>{if(t.preventDefault(),!n)return;let e=i.current;if(!e)return;let l=e.getBoundingClientRect(),a=t.clientX-l.left,r=t.clientY-l.top;for(let t=g.length-1;t>=0;t--){let e=g[t];if(a>=e.startX&&a<=e.startX+e.width&&r>=e.startY&&r<=e.startY+e.height)return void f(t=>t.filter(t=>t.id!==e.id))}},className:"cursor-crosshair block w-full border border-gray-300 rounded-lg"})})}),(0,a.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,a.jsx)("button",{onClick:()=>{f([]),u(null)},disabled:0===g.length,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"선택 초기화"}),(0,a.jsx)("button",{onClick:M,disabled:0===g.length||x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"처리 중...":"번역 완료"}),(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"취소"})]}),g.length>0&&(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["선택된 영역: ",g.length,"개",g.filter(t=>t.translatedText).length>0&&" (번역 완료: ".concat(g.filter(t=>t.translatedText).length,"개)")]})]})})})})}}}]);